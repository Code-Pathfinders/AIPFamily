# 连线样式配置和详情面板优化说明

## 🎨 本次更新内容

### 1. PC模式详情面板宽度优化

**问题**：PC模式下右侧详情面板宽度不足，信息显示不全

**解决方案**：
- 将详情面板宽度从 `320px` 增加到 `360px`
- 添加 `overflow: hidden` 防止内容溢出
- 确保所有信息卡片内容完整显示

```css
.detail-panel {
  width: 360px;  /* 从320px增加到360px */
  background: #f8f9fa;
  border-left: 1px solid #e8e8e8;
  display: flex;
  flex-direction: column;
  overflow: hidden;  /* 新增 */
}
```

### 2. 连线样式手动配置功能

**功能说明**：
现在可以在"显示配置"面板中自定义连线样式，包括：
- 父子关系线颜色和样式
- 母子关系线颜色和样式
- 线宽设置
- 阴影效果开关

#### 2.1 配置界面

在"显示配置"面板中新增"🔗 连线样式"部分：

**父子关系线配置**：
- 颜色选择器（默认：`#5B8FF9` 蓝色）
- 样式选择：实线 / 虚线（默认：实线）

**母子关系线配置**：
- 颜色选择器（默认：`#F759AB` 粉色）
- 样式选择：实线 / 虚线（默认：虚线）

**通用设置**：
- 线宽：1-5px（默认：2.5px）
- 显示阴影：开/关（默认：开）

#### 2.2 类型定义

新增 `EdgeStyleConfig` 接口：

```typescript
export interface EdgeStyleConfig {
  fatherLineColor: string      // 父子关系线颜色
  motherLineColor: string      // 母子关系线颜色
  lineWidth: number            // 线宽
  fatherLineStyle: 'solid' | 'dashed'  // 父子关系线样式
  motherLineStyle: 'solid' | 'dashed'  // 母子关系线样式
  showShadow: boolean          // 是否显示阴影
}
```

更新 `GraphDisplayConfig` 接口：

```typescript
export interface GraphDisplayConfig {
  layoutDirection: LayoutDirection
  cardFields: CardFieldConfig
  nodeWidth: number
  nodeHeight: number
  nodeSpacing: number
  rankSpacing: number
  edgeStyle: EdgeStyleConfig  // 新增
}
```

#### 2.3 默认配置

```typescript
edgeStyle: {
  fatherLineColor: '#5B8FF9',    // 蓝色
  motherLineColor: '#F759AB',    // 粉色
  lineWidth: 2.5,                // 2.5px
  fatherLineStyle: 'solid',      // 实线
  motherLineStyle: 'dashed',     // 虚线
  showShadow: true               // 显示阴影
}
```

#### 2.4 配置UI

```vue
<!-- 连线样式配置 -->
<div class="config-section">
  <h4>🔗 连线样式</h4>
  <div class="edge-style-options">
    <!-- 父子关系线 -->
    <div class="edge-group">
      <h5>父子关系线</h5>
      <div class="edge-config">
        <div class="color-input">
          <label>颜色：</label>
          <input type="color" v-model="localConfig.edgeStyle.fatherLineColor" />
          <span>{{ localConfig.edgeStyle.fatherLineColor }}</span>
        </div>
        <div class="style-select">
          <label>样式：</label>
          <select v-model="localConfig.edgeStyle.fatherLineStyle">
            <option value="solid">━━ 实线</option>
            <option value="dashed">┈┈ 虚线</option>
          </select>
        </div>
      </div>
    </div>

    <!-- 母子关系线 -->
    <div class="edge-group">
      <h5>母子关系线</h5>
      <div class="edge-config">
        <div class="color-input">
          <label>颜色：</label>
          <input type="color" v-model="localConfig.edgeStyle.motherLineColor" />
          <span>{{ localConfig.edgeStyle.motherLineColor }}</span>
        </div>
        <div class="style-select">
          <label>样式：</label>
          <select v-model="localConfig.edgeStyle.motherLineStyle">
            <option value="solid">━━ 实线</option>
            <option value="dashed">┈┈ 虚线</option>
          </select>
        </div>
      </div>
    </div>

    <!-- 通用设置 -->
    <div class="edge-common">
      <div class="size-input">
        <label>线宽：</label>
        <input type="number" v-model.number="localConfig.edgeStyle.lineWidth" 
               min="1" max="5" step="0.5" />
        <span>px</span>
      </div>
      <label class="checkbox-option">
        <input type="checkbox" v-model="localConfig.edgeStyle.showShadow" />
        <span>显示阴影</span>
      </label>
    </div>
  </div>
</div>
```

#### 2.5 样式应用

在 `FamilyTree.vue` 中根据配置动态生成连线样式：

```typescript
// 父子关系边
if (member.fatherId) {
  const edgeStyle = props.displayConfig.edgeStyle
  const fatherColor = edgeStyle.fatherLineColor
  const shadowColor = `rgba(${parseInt(fatherColor.slice(1, 3), 16)}, ${parseInt(fatherColor.slice(3, 5), 16)}, ${parseInt(fatherColor.slice(5, 7), 16)}, 0.2)`
  
  edges.push({
    id: `${member.fatherId}-${member.id}`,
    source: member.fatherId,
    target: member.id,
    type: 'cubic-vertical',
    style: {
      stroke: fatherColor,
      lineWidth: edgeStyle.lineWidth,
      opacity: 0.8,
      ...(edgeStyle.fatherLineStyle === 'dashed' ? { lineDash: [8, 4] } : {}),
      ...(edgeStyle.showShadow ? { shadowColor, shadowBlur: 10 } : {}),
      endArrow: {
        path: G6.Arrow.triangle(10, 12, 0),
        fill: fatherColor,
        opacity: 0.8
      }
    }
  })
}
```

## 📋 修改的文件

### 1. Frontend/src/types/index.ts
**新增内容**：
- `EdgeStyleConfig` 接口定义
- `GraphDisplayConfig` 接口添加 `edgeStyle` 属性

### 2. Frontend/src/views/FamilyTreeView.vue
**修改内容**：
- 详情面板宽度从320px增加到360px
- `displayConfig` 添加 `edgeStyle` 默认配置

### 3. Frontend/src/components/DisplayConfigPanel.vue
**新增内容**：
- 连线样式配置UI
- 父子关系线颜色和样式选择
- 母子关系线颜色和样式选择
- 线宽和阴影开关
- `resetConfig` 方法添加 `edgeStyle` 默认值

**新增样式**：
```css
.edge-style-options { /* 连线样式选项容器 */ }
.edge-group { /* 连线组（父子/母子） */ }
.edge-config { /* 连线配置项 */ }
.color-input { /* 颜色选择器 */ }
.style-select { /* 样式选择下拉框 */ }
.edge-common { /* 通用设置 */ }
```

### 4. Frontend/src/components/FamilyTree.vue
**修改内容**：
- 使用 `props.displayConfig.edgeStyle` 配置连线样式
- 动态生成父子关系线颜色和样式
- 动态生成母子关系线颜色和样式
- 根据配置决定是否显示阴影
- 根据配置设置线宽

## 🎯 功能特点

### 连线样式配置

**1. 灵活的颜色选择**
- 使用HTML5颜色选择器
- 实时显示颜色值（HEX格式）
- 支持任意颜色自定义

**2. 多样的线条样式**
- 实线：适合表示直接关系
- 虚线：适合区分不同类型关系

**3. 可调节的线宽**
- 范围：1-5px
- 步进：0.5px
- 默认：2.5px

**4. 可选的阴影效果**
- 增强立体感
- 提升视觉层次
- 可根据性能需求关闭

### 详情面板优化

**1. 更宽的显示区域**
- 从320px增加到360px
- 信息显示更完整
- 避免文字截断

**2. 防止内容溢出**
- 添加overflow控制
- 确保布局稳定

## 🚀 使用方法

### 配置连线样式

1. **打开配置面板**
   - 点击顶部工具栏的"⚙️ 显示配置"按钮

2. **滚动到连线样式部分**
   - 找到"🔗 连线样式"标题

3. **配置父子关系线**
   - 点击颜色选择器选择颜色
   - 在下拉框中选择线条样式（实线/虚线）

4. **配置母子关系线**
   - 同样方式配置母子关系线

5. **调整通用设置**
   - 使用数字输入框调整线宽
   - 勾选/取消"显示阴影"

6. **应用配置**
   - 点击"应用配置"按钮
   - 族谱图立即更新

### 重置默认样式

点击"重置默认"按钮，恢复到默认配置：
- 父子关系：蓝色实线
- 母子关系：粉色虚线
- 线宽：2.5px
- 阴影：开启

## 💡 使用建议

### 颜色搭配

**1. 对比色方案**
- 父子关系：蓝色系（#5B8FF9）
- 母子关系：粉色系（#F759AB）
- 优点：区分明显，易于识别

**2. 同色系方案**
- 父子关系：深蓝（#1890FF）
- 母子关系：浅蓝（#69C0FF）
- 优点：视觉统一，更协调

**3. 传统配色**
- 父子关系：黑色（#000000）
- 母子关系：红色（#FF0000）
- 优点：符合传统族谱习惯

### 线条样式选择

**实线适用场景**：
- 强调直接血缘关系
- 需要清晰明确的连接
- 打印输出

**虚线适用场景**：
- 区分不同类型关系
- 视觉层次分明
- 屏幕显示

### 性能优化

**大型族谱（>100人）**：
- 建议关闭阴影效果
- 减小线宽（1.5-2px）
- 使用实线样式

**小型族谱（<50人）**：
- 可开启所有效果
- 使用较粗线宽（2.5-3px）
- 阴影增强立体感

## 📱 移动端适配

连线样式配置在移动端同样可用：
- 颜色选择器适配触摸操作
- 下拉框易于点击
- 数字输入框支持触摸调整

## ⚠️ 注意事项

1. **颜色对比度**
   - 确保连线颜色与背景有足够对比度
   - 避免使用过浅的颜色

2. **线宽设置**
   - 过细的线条（<1.5px）可能难以看清
   - 过粗的线条（>4px）可能遮挡节点

3. **阴影效果**
   - 阴影会略微影响性能
   - 成员数量多时建议关闭

4. **配置保存**
   - 配置仅在当前会话有效
   - 刷新页面后恢复默认值
   - 后续版本将支持配置持久化

## 🔄 后续优化方向

### 连线样式

1. **更多线条样式**
   - 点线
   - 双线
   - 渐变线

2. **配偶关系线**
   - 独立的配偶关系线配置
   - 不同的颜色和样式

3. **连线标签**
   - 显示关系类型
   - 显示代数差

4. **动画效果**
   - 连线绘制动画
   - 悬停高亮效果

### 配置管理

1. **配置预设**
   - 多套预设方案
   - 快速切换

2. **配置导入导出**
   - JSON格式导出
   - 配置分享

3. **配置持久化**
   - LocalStorage保存
   - 云端同步

---

**更新版本**：v1.4.0  
**更新日期**：2025-11-04  
**更新内容**：连线样式手动配置、详情面板宽度优化
