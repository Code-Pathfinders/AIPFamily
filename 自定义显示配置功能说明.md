# 自定义显示配置功能说明

## 🎯 功能概述

新增了强大的自定义显示配置功能，允许用户：
1. **自定义卡片显示字段** - 选择在族谱节点上显示哪些信息
2. **自定义布局方向** - 选择族谱图的布局方向（自上而下、自下而上、从左到右、从右到左）
3. **调整节点尺寸和间距** - 自定义节点大小和节点之间的距离

## 📋 功能详情

### 1. 布局方向配置

支持四种布局方向：

| 方向 | 代码 | 说明 | 适用场景 |
|------|------|------|----------|
| ⬇️ 自上而下 | TB | 从上到下排列，祖辈在上，后代在下 | 传统族谱展示（默认） |
| ⬆️ 自下而上 | BT | 从下到上排列，后代在上，祖辈在下 | 反向查看祖先 |
| ➡️ 从左到右 | LR | 从左到右排列，祖辈在左，后代在右 | 横向时间线展示 |
| ⬅️ 从右到左 | RL | 从右到左排列，后代在左，祖辈在右 | 反向横向展示 |

**效果示例：**

```
TB (自上而下):        LR (从左到右):
    祖父                祖父 → 父亲 → 子女
     |
    父亲
     |
    子女
```

### 2. 卡片显示字段配置

可以自由选择在节点卡片上显示的字段：

| 字段 | 说明 | 默认状态 |
|------|------|----------|
| 显示姓名 | 成员的姓名 | ✅ 开启 |
| 显示世代 | 第几代（如"第1代"） | ✅ 开启 |
| 显示出生年份 | 出生年份（如"2025年"） | ✅ 开启 |
| 显示性别 | 男/女 | ❌ 关闭 |
| 显示头像 | 成员头像图片 | ✅ 开启 |

**卡片布局：**

```
开启头像时：
┌─────────────────┐
│ [头像] 张三      │
│        第1代     │
│        2025年    │
└─────────────────┘

关闭头像时：
┌─────────────────┐
│      张三        │
│      第1代       │
│      2025年      │
└─────────────────┘
```

### 3. 节点尺寸配置

可调整节点的宽度和高度：

- **节点宽度**：100-300px（默认150px）
- **节点高度**：60-200px（默认80px）

### 4. 间距配置

可调整节点之间的距离：

- **节点间距**：同一层级节点之间的水平距离（20-200px，默认50px）
- **层级间距**：不同层级之间的垂直距离（50-300px，默认100px）

## 🎨 使用方法

### 方式一：通过配置面板（推荐）

1. 点击工具栏的 **"⚙️ 显示配置"** 按钮
2. 在弹出的配置面板中进行设置：
   - 选择布局方向
   - 勾选要显示的字段
   - 调整节点尺寸和间距
3. 点击 **"应用配置"** 按钮查看效果
4. 如需恢复默认，点击 **"重置默认"** 按钮

### 方式二：通过代码配置

在 `FamilyTreeView.vue` 中修改 `displayConfig`：

```typescript
const displayConfig = ref<GraphDisplayConfig>({
  layoutDirection: 'TB',  // 布局方向
  cardFields: {
    showName: true,         // 显示姓名
    showGeneration: true,   // 显示世代
    showBirthYear: true,    // 显示出生年份
    showGender: false,      // 显示性别
    showAvatar: true        // 显示头像
  },
  nodeWidth: 150,          // 节点宽度
  nodeHeight: 80,          // 节点高度
  nodeSpacing: 50,         // 节点间距
  rankSpacing: 100         // 层级间距
})
```

## 💡 使用场景

### 场景1：简洁模式
**需求**：只显示姓名和世代，节点更紧凑

**配置**：
- 关闭：出生年份、性别、头像
- 节点宽度：120px
- 节点高度：60px
- 节点间距：30px

### 场景2：详细模式
**需求**：显示所有信息，便于查看详情

**配置**：
- 开启：所有字段
- 节点宽度：180px
- 节点高度：100px
- 层级间距：120px

### 场景3：横向时间线
**需求**：按时间线从左到右展示家族发展

**配置**：
- 布局方向：从左到右（LR）
- 显示：姓名、出生年份
- 节点间距：80px

### 场景4：大屏展示
**需求**：在大屏幕上展示，节点更大更清晰

**配置**：
- 节点宽度：200px
- 节点高度：120px
- 节点间距：100px
- 层级间距：150px

## 🔧 技术实现

### 核心组件

1. **DisplayConfigPanel.vue** - 配置面板组件
   - 提供可视化配置界面
   - 实时预览配置效果

2. **FamilyTree.vue** - 族谱图组件
   - 接收 `displayConfig` 属性
   - 根据配置动态渲染节点
   - 监听配置变化自动重绘

3. **类型定义** - `types/index.ts`
   - `GraphDisplayConfig` - 图形显示配置
   - `CardFieldConfig` - 卡片字段配置
   - `LayoutDirection` - 布局方向类型

### 数据流

```
用户操作配置面板
    ↓
DisplayConfigPanel 发出 change 事件
    ↓
FamilyTreeView 更新 displayConfig
    ↓
FamilyTree 监听到配置变化
    ↓
重新初始化图形并渲染
    ↓
显示新的布局效果
```

### 关键代码

**节点动态渲染：**
```typescript
// 根据配置显示字段
if (fieldConfig.showName) {
  // 绘制姓名
}
if (fieldConfig.showGeneration) {
  // 绘制世代
}
if (fieldConfig.showBirthYear && member.birthDate) {
  // 绘制出生年份
}
```

**布局方向配置：**
```typescript
layout: {
  type: 'dagre',
  rankdir: props.displayConfig.layoutDirection,  // TB/BT/LR/RL
  nodesep: props.displayConfig.nodeSpacing,
  ranksep: props.displayConfig.rankSpacing
}
```

## 📊 配置持久化

当前配置保存在组件状态中，页面刷新后会恢复默认值。

**未来扩展方向：**
1. 将配置保存到 localStorage
2. 将配置保存到数据库（与家族关联）
3. 支持多套配置方案切换
4. 支持导入/导出配置

## 🎯 最佳实践

1. **首次使用**：使用默认配置，熟悉基本功能
2. **调整布局**：根据家族规模选择合适的布局方向
3. **精简显示**：成员较多时，关闭部分字段以减少视觉负担
4. **保存布局**：调整好配置后，记得点击"保存布局"保存节点位置

## ⚠️ 注意事项

1. **配置变化会重新初始化图形**，已拖拽的节点位置会重置
2. **建议先配置好显示选项**，再调整节点位置
3. **节点过大或间距过小**可能导致节点重叠
4. **横向布局（LR/RL）**适合层级较少的家族

## 🚀 快速开始

1. 打开族谱管理系统
2. 选择一个家族
3. 点击 **"⚙️ 显示配置"** 按钮
4. 尝试不同的布局方向
5. 调整显示字段
6. 点击 **"应用配置"** 查看效果

---

**功能版本**：v1.1.0  
**更新日期**：2025-11-04
